<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BetterCal - Plan de Produccion</title>
  <style>
    :root {
      --bg-primary: #1a1a1a;
      --bg-secondary: #2a2a2a;
      --bg-tertiary: #333;
      --text-primary: #e5e5e5;
      --text-secondary: #a3a3a3;
      --text-muted: #737373;
      --accent-blue: #3b82f6;
      --accent-green: #22c55e;
      --accent-orange: #f59e0b;
      --accent-red: #ef4444;
      --border-color: #404040;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
      padding: 40px 20px;
      max-width: 800px;
      margin: 0 auto;
    }

    h1 {
      font-size: 2rem;
      font-weight: 600;
      margin-bottom: 8px;
      color: var(--text-primary);
    }

    h2 {
      font-size: 1.4rem;
      font-weight: 600;
      margin-top: 40px;
      margin-bottom: 16px;
      padding-bottom: 8px;
      border-bottom: 1px solid var(--border-color);
      color: var(--text-primary);
    }

    h3 {
      font-size: 1.1rem;
      font-weight: 600;
      margin-top: 24px;
      margin-bottom: 12px;
      color: var(--text-primary);
    }

    p {
      margin-bottom: 12px;
      color: var(--text-secondary);
    }

    ul, ol {
      margin-bottom: 16px;
      padding-left: 24px;
    }

    li {
      margin-bottom: 6px;
      color: var(--text-secondary);
    }

    li strong {
      color: var(--text-primary);
    }

    code {
      background: var(--bg-tertiary);
      padding: 2px 6px;
      border-radius: 4px;
      font-family: 'SF Mono', Monaco, 'Courier New', monospace;
      font-size: 0.9em;
      color: var(--accent-orange);
    }

    pre {
      background: var(--bg-secondary);
      padding: 16px;
      border-radius: 8px;
      overflow-x: auto;
      margin-bottom: 16px;
      border: 1px solid var(--border-color);
    }

    pre code {
      background: none;
      padding: 0;
      color: var(--text-secondary);
    }

    .badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      margin-left: 8px;
      vertical-align: middle;
    }

    .badge-done {
      background: var(--accent-green);
      color: #000;
    }

    .badge-decided {
      background: var(--accent-blue);
      color: #fff;
    }

    .badge-pending {
      background: var(--accent-orange);
      color: #000;
    }

    .badge-future {
      background: var(--text-muted);
      color: #fff;
    }

    .card {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 16px;
    }

    .card-title {
      font-weight: 600;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .card p {
      margin-bottom: 8px;
    }

    .card ul {
      margin-bottom: 0;
    }

    .question-card {
      border-left: 3px solid var(--accent-orange);
    }

    .decision-card {
      border-left: 3px solid var(--accent-green);
    }

    .phase {
      counter-increment: phase;
    }

    .phase::before {
      content: counter(phase) ". ";
      color: var(--accent-blue);
      font-weight: 600;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 16px;
    }

    th, td {
      padding: 10px 12px;
      text-align: left;
      border-bottom: 1px solid var(--border-color);
    }

    th {
      background: var(--bg-secondary);
      color: var(--text-primary);
      font-weight: 600;
    }

    td {
      color: var(--text-secondary);
    }

    hr {
      border: none;
      border-top: 1px solid var(--border-color);
      margin: 32px 0;
    }

    .subtitle {
      color: var(--text-muted);
      font-size: 0.9rem;
      margin-bottom: 32px;
    }

    a {
      color: var(--accent-blue);
      text-decoration: none;
    }

    a:hover {
      text-decoration: underline;
    }

    @media (max-width: 600px) {
      body {
        padding: 20px 16px;
      }
    }
  </style>
</head>
<body>

<h1>BetterCal - Plan de Produccion</h1>
<p class="subtitle">Ultima actualizacion: Febrero 2026</p>

<h2>Progreso Actual</h2>

<div class="card decision-card">
  <div class="card-title">Fase 1: Research y Benchmark <span class="badge badge-done">Hecho</span></div>
  <p>Investigacion de apps existentes y definicion de features</p>
</div>

<div class="card decision-card">
  <div class="card-title">Fase 2: Prototipo Estatico <span class="badge badge-done">Hecho</span></div>
  <p>Implementacion en <code>prototype.html</code> (4,569 lineas, React 18 + Babel standalone)</p>
  <ul>
    <li>UI completa: Desktop (12 dias + sidebar) y Mobile (1 dia con swipe)</li>
    <li>Modelo de datos: items con recurrencia, excepciones, esfuerzo, categorias</li>
    <li>Drag and drop, shimmer animations, popovers, dark/light theme</li>
    <li>Safe-area para iPhone</li>
  </ul>
</div>

<div class="card decision-card">
  <div class="card-title">Fase 3: Pruebas de UX <span class="badge badge-done">Hecho</span></div>
  <p>Testing de interacciones y debugging del prototipo</p>
</div>

<hr>

<h2>Decisiones Tomadas</h2>

<h3>Autenticacion <span class="badge badge-decided">Decidido</span></h3>

<div class="card decision-card">
  <div class="card-title">Cloudflare Access</div>
  <p>Login simple tipo "el browser pide user y pass" antes de ver la app</p>
  <ul>
    <li>Email OTP (codigo por email) - sin crear cuentas</li>
    <li>Gratis hasta 50 usuarios</li>
    <li>Configuracion en 5 minutos via dashboard</li>
    <li>Protege la app ANTES de que llegue al servidor</li>
  </ul>
</div>

<h3>Base de Datos <span class="badge badge-decided">Decidido</span></h3>

<div class="card decision-card">
  <div class="card-title">IndexedDB (local) + Supabase (cloud)</div>
  <p>Arquitectura offline-first con sync a la nube</p>
  <pre><code>IndexedDB (offline) &lt;-&gt; Supabase (cloud sync) -&gt; Google Calendar (export opcional, futuro)</code></pre>
  <ul>
    <li><strong>IndexedDB:</strong> Persistencia local con Dexie.js</li>
    <li><strong>Supabase:</strong> PostgreSQL gratuito, sync en tiempo real</li>
    <li><strong>Offline:</strong> Cola de operaciones pendientes, sync al reconectar</li>
  </ul>
</div>

<h3>Por que NO Google Calendar como DB</h3>
<div class="card">
  <ul>
    <li>Modelo de datos incompatible (no soporta <code>sortOrder</code>, <code>exceptions</code>, <code>hiddenFromSidebar</code>)</li>
    <li>Si crean evento en Calendar a las 10am, apareceria en "Importante" aunque no sea tarea</li>
    <li>Requiere OAuth completo (mas complejo)</li>
    <li>Rate limits de API</li>
  </ul>
</div>

<h3>PWA <span class="badge badge-decided">Decidido</span></h3>

<div class="card decision-card">
  <div class="card-title">Si, con soporte iOS</div>
  <ul>
    <li>Agregar a Home Screen funciona desde iOS 11.3+</li>
    <li>Pantalla completa (sin barra Safari)</li>
    <li>Splash screen e icono custom</li>
    <li><strong>Limitacion iOS:</strong> No soporta Push Notifications en PWAs</li>
  </ul>
</div>

<h3>Hosting <span class="badge badge-decided">Decidido</span></h3>

<div class="card decision-card">
  <div class="card-title">Cloudflare Pages</div>
  <ul>
    <li>Deploy automatico desde GitHub</li>
    <li>Integracion nativa con Cloudflare Access</li>
    <li>CDN global gratuito</li>
  </ul>
</div>

<h3>Google Calendar <span class="badge badge-future">Futuro</span></h3>

<div class="card">
  <p>Export opcional dejado para despues de tener la app funcionando con persistencia propia.</p>
</div>

<hr>

<h2>Preguntas Pendientes</h2>

<h3>Notificaciones <span class="badge badge-pending">Por decidir</span></h3>

<div class="card question-card">
  <div class="card-title">Como manejar notificaciones?</div>
  <p><strong>Contexto:</strong> La app de Google Calendar no muestra bien las notificaciones actualizadas, hay que entrar a la app para ver lo correcto.</p>

  <p><strong>Opciones:</strong></p>
  <ul>
    <li><strong>Push Notifications nativas:</strong> Funciona en desktop (Chrome/Firefox/macOS). En iOS PWA NO funciona.</li>
    <li><strong>Telegram Bot:</strong> Mensajes que llegan bien, funciona en todos los dispositivos. Requiere crear un bot y que el usuario lo agregue.</li>
    <li><strong>Ambos:</strong> Push donde funcione + Telegram como fallback.</li>
  </ul>
</div>

<h3>Integracion Apple Health/Sleep <span class="badge badge-pending">Por decidir</span></h3>

<div class="card question-card">
  <div class="card-title">Conectar con datos de salud de Apple?</div>
  <p><strong>Ideas:</strong></p>
  <ul>
    <li>Energia del dia automatica segun horas dormidas</li>
    <li>Icono cuando se completaron calorias/ejercicio del dia</li>
  </ul>

  <p><strong>Realidad tecnica:</strong></p>
  <ul>
    <li>Apple Health no tiene API web - solo apps nativas iOS pueden acceder</li>
    <li><strong>Opcion A:</strong> Shortcut de iOS que lee Health y envia datos a Supabase</li>
    <li><strong>Opcion B:</strong> App nativa minima que sincronice (mas complejo)</li>
    <li><strong>Opcion C:</strong> Usar servicio intermediario (ej: Apple Health a Strava a webhook)</li>
  </ul>
</div>

<h3>Eventos de Gmail/Calendar <span class="badge badge-pending">Por decidir</span></h3>

<div class="card question-card">
  <div class="card-title">Mostrar invites de calendario que llegan a Gmail?</div>
  <p><strong>Ideas:</strong></p>
  <ul>
    <li>Mostrar eventos de Google Calendar como items read-only</li>
    <li>Popover mostraria: participantes, link de Google Meet si hay</li>
    <li>Estos eventos tendrian horario exacto (a diferencia de tareas)</li>
  </ul>

  <p><strong>Preguntas abiertas:</strong></p>
  <ul>
    <li>Deberia poder asignar horario a cualquier tarea si quiero?</li>
    <li>O resolverlo poniendo horario en el titulo? Ej: "10:35 Reunion trabajo"</li>
  </ul>

  <p><strong>Consideraciones:</strong></p>
  <ul>
    <li>Si agregamos horarios opcionales, el modelo de datos cambiaria</li>
    <li>El mapeo estados a franjas horarias se complicaria con eventos con hora especifica</li>
    <li>Opcion simple: horario en titulo, sin cambios al modelo</li>
  </ul>
</div>

<hr>

<h2>Fases de Implementacion Pendientes</h2>

<ol style="counter-reset: phase 3;">
  <li class="phase"><strong>Build System + Persistencia Local</strong>
    <ul>
      <li>Crear proyecto Vite con React</li>
      <li>Migrar codigo de <code>prototype.html</code> a componentes modulares</li>
      <li>Implementar IndexedDB (Dexie.js) para items, categorias, energia</li>
      <li>Hostear fonts localmente (IBM Plex Sans)</li>
    </ul>
  </li>

  <li class="phase"><strong>PWA</strong>
    <ul>
      <li>Crear <code>manifest.json</code></li>
      <li>Generar iconos (192px, 512px, apple-touch-icon 180px)</li>
      <li>Service worker con cache de assets</li>
      <li>Meta tags para iOS</li>
    </ul>
  </li>

  <li class="phase"><strong>Deploy con Auth</strong>
    <ul>
      <li>Push a GitHub</li>
      <li>Conectar repo a Cloudflare Pages</li>
      <li>Configurar Cloudflare Access (email permitido)</li>
    </ul>
  </li>

  <li class="phase"><strong>Sync Cloud + Offline</strong>
    <ul>
      <li>Configurar Supabase (PostgreSQL gratuito)</li>
      <li>Crear tablas: <code>items</code>, <code>categories</code>, <code>day_energy</code></li>
      <li>Implementar sync bidireccional</li>
      <li>Cola de operaciones offline</li>
      <li>Resolucion de conflictos (Last Write Wins)</li>
    </ul>
  </li>
</ol>

<hr>

<h2>Estructura de Proyecto Propuesta</h2>

<pre><code>bettercal/
  public/
    manifest.json
    icons/
      icon-192.png
      icon-512.png
      apple-touch-icon.png
    fonts/
      IBMPlexSans-*.woff2
  src/
    App.jsx
    main.jsx
    components/
      ItemCard.jsx
      SlotSection.jsx
      CategorySection.jsx
      mobile/
        BottomSheet.jsx
        MobileFooter.jsx
    hooks/
      useLocalStorage.js
      useOfflineSync.js
    lib/
      db.js          # IndexedDB con Dexie
      sync.js        # Logica de sync
    utils/
      dates.js
      recurring.js
  index.html
  package.json
  vite.config.js
  sw.js              # Service Worker</code></pre>

<hr>

<h2>Archivos Criticos</h2>

<table>
  <thead>
    <tr>
      <th>Archivo</th>
      <th>Proposito</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>prototype.html</code></td>
      <td>Codigo fuente completo a migrar</td>
    </tr>
    <tr>
      <td><code>context.md</code></td>
      <td>Documentacion del modelo de datos</td>
    </tr>
    <tr>
      <td><code>src/lib/db.js</code></td>
      <td>IndexedDB con Dexie (a crear)</td>
    </tr>
    <tr>
      <td><code>src/hooks/useOfflineSync.js</code></td>
      <td>Cola de operaciones offline (a crear)</td>
    </tr>
    <tr>
      <td><code>manifest.json</code></td>
      <td>Configuracion PWA (a crear)</td>
    </tr>
  </tbody>
</table>

<hr>

<h2>Verificacion</h2>

<ol>
  <li><strong>Local:</strong> <code>npm run dev</code> - app funciona, datos persisten al refrescar</li>
  <li><strong>PWA iPhone:</strong> Agregar a home, abrir offline, verificar que carga</li>
  <li><strong>Auth:</strong> Acceder a URL, verificar que pide login</li>
  <li><strong>Offline sync:</strong> Crear item sin conexion, reconectar, verificar que sincroniza</li>
</ol>

</body>
</html>
